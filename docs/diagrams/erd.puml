@startuml
hide circle
skinparam linetype ortho

entity "artifacts" as artifacts {
  * id : uuid <<generated>>
  --
  * filename : character varying
  * created_at : timestamp without time zone <<generated>>
  * content_type : character varying
  * key : character varying
  * content_length : integer
  * uri : character varying
}

entity "teams" as teams {
  * id : uuid <<generated>>
  --
  * type : USER-DEFINED
  * created_at : timestamp without time zone <<generated>>
  * name : character varying
}

entity "workflows" as workflows {
  * id : uuid <<generated>>
  --
  * data : text
  * created_at : timestamp without time zone <<generated>>
  * status : character varying <<generated>>
}

entity "files" as files {
  * id : uuid <<generated>>
  --
  * project_id : uuid <<FK>>
  * idx : integer
  * name : character varying
  * created_at : timestamp without time zone <<generated>>
}

entity "all_events *VIEW*" as all_events {
  id : uuid
  --
  ctx : jsonb
  emitted_at : timestamp without time zone
  event_type : text
  data : jsonb
  model_id : uuid <<FK>>
  emitted_by : uuid
}

entity "event_types" as event_types {
  * id : uuid <<generated>>
  --
  * category : character varying
  * name : character varying
}

entity "users" as users {
  * id : uuid <<generated>>
  --
  * email : character varying
  * first_name : character varying
  * last_name : character varying
  * created_at : timestamp without time zone <<generated>>
  * handle : character varying
  * mobile_number : character varying
}

entity "file_versions" as file_versions {
  * id : uuid <<generated>>
  --
  * artifact_id : uuid <<FK>>
  * created_at : timestamp without time zone <<generated>>
  * file_id : uuid <<FK>>
  * name : character varying
}

entity "events" as events {
  * id : uuid <<generated>>
  --
  * emitted_at : timestamp without time zone <<generated>>
  data : jsonb
  ctx : jsonb
  * model_id : uuid <<FK>>
  * event_type_id : uuid <<FK>>
  emitted_by : uuid
}

entity "comments" as comments {
  * id : uuid <<generated>>
  --
  * file_version_id : uuid <<FK>>
  comment_id : uuid <<FK>>
  * created_by : uuid
  * created_at : timestamp without time zone <<generated>>
  selection : numrange
  * body : text
}

entity "projects" as projects {
  * id : uuid <<generated>>
  --
  * name : character varying
  * team_id : uuid <<FK>>
  * created_at : timestamp without time zone <<generated>>
}

entity "user_teams" as user_teams {
  * team_id : uuid <<FK>>
  * user_id : uuid <<FK>>
}

entity "user_events *VIEW*" as user_events {
  id : uuid
  --
  event_type : text
  emitted_at : timestamp without time zone
  emitted_by : uuid
  user_id : uuid <<FK>>
  ctx : jsonb
  model_id : uuid <<FK>>
  data : jsonb
}

projects ..o files
artifacts ..o file_versions
files ..o file_versions
event_types ..o events
file_versions ..o comments
comments ..o comments
teams ..o projects
teams ..o user_teams
users ..o user_teams
users ..o user_events

@enduml
